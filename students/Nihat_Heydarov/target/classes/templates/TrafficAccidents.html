<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="ISO-8859-1">
		<script
		    src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<link rel="stylesheet"
		    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		<script type="text/javascript"
		    src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
	<form style="margin-left:70px;margin-top:50px;" action="#" th:action="@{/data/traffic-accidents/search}" th:object="${SearchObject}" method="post">
		<p>Search for accident count, dates and reasons by occured accidents municipality and year</p> 
		<select class="form-select" id="municipality" name="municipality" th:field="*{municipality}">
	
	<option th:each="municipality:${municipalities}" th:text="${municipality}" th:value="${municipality}"></option>
</select>

<select class="form-select"  th:field="*{year}">
	
	<option th:each="year:${years}" th:text="${year}" th:value="${year}"></option>
</select>
    <input class="btn btn-primary" type="submit" value="Submit">
	</form>




<div id="chart_div" style="width:900px; height:500px;"></div>

<table class="table">
	<thead>
		<tr>
			<th scope="col">Date</th>
			<th scope="col">Incident location</th>
			<th scope="col">Weather condition</th>
			<th scope="col">Municipality</th>
		</tr>
	</thead>
	<tbody>
		<tr th:each="data : ${FirstFifty}">
			<td th:text="${data.getDateTime()}"></td>
			<td th:text="${data.getIncidentLocation()}"></td>
			<td th:text="${data.getWeatherCondition()}"></td>
			<td th:text="${data.getMunicipality()}"></td>
		</tr>
	</tbody>
</table>

<h4>Report</h4>
<p>
The road surface conditions were 
<span th:each="data : ${SurfaceConditions}" th:text="${data}+' ,'"></span>
which contributed to the occurence of traffic accidents.
Among the report cases, there were 
<span th:text="${DrunkCounter}"></span> drunk offenders and
<span th:text="${IntoxicatedCounter}"></span> offenders under the influnce of drugs or intoxicating substances substances.
Additionally
<span th:text="${DriverLicenceCounter}"></span> drivers involved in the accidents did not possess a valid driving licence.	
</p>

<script th:inline="javascript">
	/*<![CDATA[*/
	var real_data = /*[[${monthsAndDays}]]*/'noValue';
	/*]]>*/
	$(document).ready(function(){
		google.charts.load('current',{
			packages : ['corechart','bar']
		});
		google.charts.setOnLoadCallback(drawColumnChart);
	})
	function drawColumnChart(){
		var data = new google.visualization.DataTable();
		data.addColumn('string', 'Dates');
		data.addColumn('number', 'Accidents(rates)');
		Object.keys(real_data).forEach(function(key){
			data.addRow([key, real_data[key]]);
		});
		var options = {
			title : 'Traffic accidents report',
			hAxis : {
				title : 'Dates',
			},
			vAxis : {
				title : 'Accidents'
			}
		};
		
		var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
		chart.draw(data, options);
	}
	/*]]>*/
</script>
</body>
</html>